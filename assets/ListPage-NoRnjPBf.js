import{u as f,r as g,a as j,j as e,L as b,k as y}from"./index-BxyKPxyS.js";import{S as N,c as v,u as w}from"./clsx-C_HzRheg.js";import{B as P,f as C}from"./Button-03HGzcL3.js";function S(t,r=100,s={}){if(typeof t!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof t}\`.`);if(r<0)throw new RangeError("`wait` must not be negative.");if(typeof s=="boolean")throw new TypeError("The `options` parameter must be an object, not a boolean. Use `{immediate: true}` instead.");const{immediate:i}=s;let l,o,a,n,c;function d(){const x=l,h=o;return l=void 0,o=void 0,c=t.apply(x,h),c}function p(){const x=Date.now()-n;x<r&&x>=0?a=setTimeout(p,r-x):(a=void 0,i||(c=d()))}const u=function(...x){if(l&&this!==l&&Object.getPrototypeOf(this)===Object.getPrototypeOf(l))throw new Error("Debounced method called with different contexts of the same prototype.");l=this,o=x,n=Date.now();const h=i&&!a;if(a||(a=setTimeout(p,r)),h)return c=d(),c};return Object.defineProperty(u,"isPending",{get(){return a!==void 0}}),u.clear=()=>{a&&(clearTimeout(a),a=void 0,l=void 0,o=void 0)},u.flush=()=>{a&&u.trigger()},u.trigger=()=>{c=d(),u.clear()},u}const F=()=>{const[t,r]=f(),s=g.useMemo(()=>{const a=t.get("sort"),n=N.includes(a)?a:"date_desc";return{page:Number(t.get("page"))||1,limit:Number(t.get("limit"))||10,status:t.getAll("status"),categoryId:t.get("categoryId")||"",minPrice:t.get("minPrice")||"",maxPrice:t.get("maxPrice")||"",search:t.get("search")||"",sort:n}},[t]),i=g.useCallback((a,n)=>{r(c=>{const d=new URLSearchParams(c.toString());return a==="status"?(d.delete("status"),n.forEach(p=>d.append("status",p))):n===""||n===null?d.delete(a):d.set(a,String(n)),a!=="page"&&d.set("page","1"),d})},[r]),l=g.useMemo(()=>S(a=>i("search",a),200),[i]);return{filters:s,setFilter:i,handleSearch:l,resetFilters:()=>r({})}},E=({ad:t})=>{const r=j(),s=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(t.price),i=new Date(t.createdAt).toLocaleDateString("ru-RU"),l={approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800",draft:"bg-gray-100 text-gray-800"};return e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-lg transition-shadow bg-white flex flex-col",children:[e.jsxs("div",{className:"h-48 bg-gray-200 relative",children:[e.jsx("img",{src:t.images?.[0]||"https://via.placeholder.com/300x200?text=No+Image",alt:t.title,className:"w-full h-full object-cover"}),t.priority==="urgent"&&e.jsx("span",{className:"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded uppercase font-bold",children:"Срочно"})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.category}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${l[t.status]}`,children:t.status})]}),e.jsx(b,{to:`/item/${t.id}`,state:{from:r.search},className:"font-bold text-lg mb-1 hover:text-blue-600 truncate",children:t.title}),e.jsx("div",{className:"font-bold text-xl mb-4",children:s}),e.jsx("div",{className:"mt-auto text-xs text-gray-400 flex justify-between",children:e.jsx("span",{children:i})})]})]})},m=({title:t,children:r})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("h3",{className:"font-bold mb-2",children:t}),r]}),I=({value:t,onChange:r})=>e.jsx(m,{title:"Категория",children:e.jsxs("select",{className:"border p-2 w-full rounded",value:t,onChange:s=>r("categoryId",s.target.value),children:[e.jsx("option",{value:"",children:"Все категории"}),v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),k=({min:t,max:r,onChange:s})=>e.jsx(m,{title:"Цена",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"От",className:"border p-1 w-1/2 rounded",value:t,onChange:i=>s("minPrice",i.target.value)}),e.jsx("input",{type:"number",placeholder:"До",className:"border p-1 w-1/2 rounded",value:r,onChange:i=>s("maxPrice",i.target.value)})]})}),A=({value:t,onChange:r})=>e.jsx(m,{title:"Поиск",children:e.jsx("input",{className:"border p-2 w-full rounded",placeholder:"Название...",defaultValue:t,onChange:s=>r("search",s.target.value)})}),D=({value:t,onChange:r})=>e.jsx(m,{title:"Сортировка",children:e.jsxs("select",{className:"border p-2 w-full rounded",value:t,onChange:s=>r("sort",s.target.value),children:[e.jsx("option",{value:"date_desc",children:"Сначала новые"}),e.jsx("option",{value:"date_asc",children:"Сначала старые"}),e.jsx("option",{value:"price_asc",children:"Дешевле"}),e.jsx("option",{value:"price_desc",children:"Дороже"}),e.jsx("option",{value:"priority_desc",children:"По приоритету"})]})}),O=({value:t,onChange:r})=>e.jsx(m,{title:"Статус",children:["pending","approved","rejected","draft"].map(s=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-1",children:[e.jsx("input",{type:"checkbox",checked:t.includes(s),onChange:i=>{const l=i.target.checked?[...t,s]:t.filter(o=>o!==s);r("status",l)}}),e.jsx("span",{className:"capitalize",children:s})]},s))}),T=({filtersHook:t})=>{const{filters:r,setFilter:s,resetFilters:i}=t;return e.jsxs("aside",{className:"w-1/4 min-w-[250px] space-y-4",children:[e.jsx(A,{value:r.search,onChange:s}),e.jsx(D,{value:r.sort,onChange:s}),e.jsx(I,{value:r.categoryId,onChange:s}),e.jsx(k,{min:r.minPrice,max:r.maxPrice,onChange:s}),e.jsx(O,{value:r.status,onChange:s}),e.jsx(P,{onClick:i,variant:"secondary",fullWidth:!0,children:"Сбросить фильтры"})]})},_=()=>{const t=F(),{filters:r,setFilter:s}=t,{data:i,isLoading:l,isError:o}=w({queryKey:["ads",r],queryFn:()=>C(r),placeholderData:y}),a=i?.ads||[],n=i?.pagination;return e.jsxs("div",{className:"container mx-auto p-4 flex gap-6",children:[e.jsx(T,{filtersHook:t}),e.jsxs("main",{className:"w-3/4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Объявления"}),n&&e.jsxs("span",{className:"text-gray-500",children:["Найдено: ",n.totalItems]})]}),l?e.jsx("div",{className:"text-center py-10",children:"Загрузка..."}):o?e.jsx("div",{className:"text-red-500",children:o}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.map(c=>e.jsx(E,{ad:c},c.id)),a.length===0&&e.jsx("div",{className:"col-span-3 text-center text-gray-500",children:"Объявления не найдены"})]}),n&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx("button",{disabled:n.currentPage===1,onClick:()=>s("page",String(n.currentPage-1)),className:"px-4 py-2 border rounded disabled:opacity-50",children:"Назад"}),e.jsxs("span",{className:"px-4 py-2",children:[n.currentPage," / ",n.totalPages]}),e.jsx("button",{disabled:n.currentPage===n.totalPages,onClick:()=>s("page",String(n.currentPage+1)),className:"px-4 py-2 border rounded disabled:opacity-50",children:"Вперед"})]})]})]})};export{_ as default};
